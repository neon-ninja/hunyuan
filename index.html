<html>

<head>
  <title>Hunyuan video generator</title>
</head>

<body>
  Prompt: <textarea id="prompt" rows="4" cols="50">A cat walks on the grass, realistic style.</textarea><br>
  Width (px) <input id="width" type="number" value="848" /><br>
  Height (px) <input id="height" type="number" value="480" /><br>
  # frames: <input id="length" type="number" value="73" /><br>
  seed: <input id="seed" type="number" value="0" /><input type="submit" value="Randomise" /><br>
  <!-- Civitai LoRA: <input id="lora" type="number" value="0" /><br> -->
  <input type="submit" value="Submit" /><br>
  <div id="status"></div>

  <script type="module">
    var template = await fetch("hunyuan_video_text_to_video_API.json").then(response => response.json());
    console.log(template)
    document.querySelector('input[type="submit"][value="Randomise"]').addEventListener('click', function () {
      document.getElementById('seed').value = Math.floor(Math.random() * 1000000);
    });
    document.querySelector('input[type="submit"][value="Submit"]').addEventListener('click', function () {
      var prompt = document.getElementById('prompt').value;
      template[44].inputs.text = prompt;
      var width = parseInt(document.getElementById('width').value);
      template[45].inputs.width = width;
      var height = parseInt(document.getElementById('height').value);
      template[45].inputs.height = height;
      var length = parseInt(document.getElementById('length').value);
      template[45].inputs.length = length;
      var seed = parseInt(document.getElementById('seed').value);
      template[25].inputs.noise_seed = seed;
      //var lora = parseInt(document.getElementById('lora').value);
      // https://ai.auckland-cer.cloud.edu.au/docs#/default/predict_predictions_post
      document.getElementById('status').innerText = 'Processing...';
      document.title = "Hunyuan video generator: Processing..."
      var start = new Date().getTime();
      fetch('https://ai.auckland-cer.cloud.edu.au/prompt', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          prompt: template
        })
      })
        .then(response => response.json())
        .then(function (data) {
          console.log(data)
          var time = Math.round((new Date().getTime() - start) / 1000);
          document.title = "Hunyuan video generator: Done!"
          document.getElementById('status').innerHTML = `Prompt: ${prompt}<br>Generated in ${time}s<br>Result:<br><img src="data:image/webp;base64,${data.images[0]}" />`;
        })
        .catch(error => document.getElementById('status').innerText = "Error: " + error);
    });
  </script>
</body>

</html>